@inherits LayoutComponentBase

<Layout Sider>
    <LayoutSider>
        <LayoutSiderContent>
            <Bar @ref="@sideBar" Breakpoint="Breakpoint.Desktop" NavigationBreakpoint="Breakpoint.Tablet" ThemeContrast="SidebarThemeContrast" Shadow="Shadow.Default"
                 Mode="BarMode.VerticalInline" CollapseMode="BarCollapseMode.Hide">
                <BarBrand>
                    <BarItem>
                        <BarLink To="/Admin/">
                            <BarIcon IconName="customIcon" Display="Display.InlineBlock" />&nbsp;
                            @((string)MemoryStorage.GetValue(KeyValueType.Title))
                        </BarLink>
                    </BarItem>
                </BarBrand>
                <BarMenu>
                    <BarStart>
                        <BarItem>
                            <BarLink To="/Admin/">
                                <Row>
                                    <Column ColumnSize="ColumnSize.IsAuto" Padding="Padding.Is0.FromEnd">
                                        <BarIcon IconName="IconName.Dashboard" />
                                    </Column>
                                    <Column Padding="Padding.Is2.FromStart">
                                        @Localizer["Overview"]
                                    </Column>
                                </Row>
                            </BarLink>
                        </BarItem>
                        <BarItem>
                            <BarLink To="/Admin/Homepage-Editor">
                                <Row>
                                    <Column ColumnSize="ColumnSize.IsAuto" Padding="Padding.Is0.FromEnd">
                                        <BarIcon IconName="IconName.Home" />
                                    </Column>
                                    <Column Padding="Padding.Is2.FromStart">
                                        @Localizer["HomepageEditor"]
                                    </Column>
                                </Row>
                            </BarLink>
                        </BarItem>
                        <BarItem>
                            <BarLink To="/Admin/User-Management">
                                <Row>
                                    <Column ColumnSize="ColumnSize.IsAuto" Padding="Padding.Is0.FromEnd">
                                        &nbsp;<Icon IconSize="IconSize.Large" Name="@("fa-user-cog")" />
                                    </Column>
                                    <Column Padding="Padding.Is2.FromStart">
                                        @Localizer["UserManagement"]
                                    </Column>
                                </Row>
                            </BarLink>
                        </BarItem>
                        <BarItem>
                            <BarLink To="/Admin/Team-Management">
                                <Row>
                                    <Column ColumnSize="ColumnSize.IsAuto" Padding="Padding.Is0.FromEnd">
                                        &nbsp;<Icon IconSize="IconSize.Large" Name="@("fa-project-diagram")" />
                                    </Column>
                                    <Column Padding="Padding.Is2.FromStart">
                                        @Localizer["TeamManagement"]
                                    </Column>
                                </Row>
                            </BarLink>
                        </BarItem>
                        <BarItem>
                            <BarLink To="/Admin/Activity-Editor">
                                <Row>
                                    <Column ColumnSize="ColumnSize.IsAuto" Padding="Padding.Is0.FromEnd">
                                        &nbsp;<Icon IconSize="IconSize.Large" Name="@("fa-tasks")" />
                                    </Column>
                                    <Column Padding="Padding.Is2.FromStart">
                                        @Localizer["ActivityEditor"]
                                    </Column>
                                </Row>
                            </BarLink>
                        </BarItem>
                        <BarItem>
                            <BarLink To="/Admin/Result-Editor">
                                <Row>
                                    <Column ColumnSize="ColumnSize.IsAuto" Padding="Padding.Is0.FromEnd">
                                        &nbsp;<Icon IconSize="IconSize.Large" Name="@("fa-chart-bar")" />
                                    </Column>
                                    <Column Padding="Padding.Is2.FromStart">
                                        @Localizer["ResultEditor"]
                                    </Column>
                                </Row>
                            </BarLink>
                        </BarItem>
                        <BarItem>
                            <BarLink To="/Admin/Backup-and-Restore">
                                <Row>
                                    <Column ColumnSize="ColumnSize.IsAuto" Padding="Padding.Is0.FromEnd">
                                        <BarIcon IconName="IconName.CloudDownloadAlt" />
                                    </Column>
                                    <Column Padding="Padding.Is2.FromStart">
                                        @Localizer["Backup&Restore"]
                                    </Column>
                                </Row>
                            </BarLink>
                        </BarItem>
                        <BarItem>
                            <BarLink To="/Admin/Theme-Selector">
                                <Row>
                                    <Column ColumnSize="ColumnSize.IsAuto" Padding="Padding.Is0.FromEnd">
                                        <BarIcon IconName="IconName.Palette" />
                                    </Column>
                                    <Column Padding="Padding.Is2.FromStart">
                                        @Localizer["ThemeSelector"]
                                    </Column>
                                </Row>
                            </BarLink>
                        </BarItem>
                        <BarItem>
                            <BarLink To="/Admin/Settings">
                                <Row>
                                    <Column ColumnSize="ColumnSize.IsAuto" Padding="Padding.Is0.FromEnd">
                                        &nbsp;<Icon IconSize="IconSize.Large" Name="@("fa-cog")" />
                                    </Column>
                                    <Column Padding="Padding.Is2.FromStart">
                                        @Localizer["Settings"]
                                    </Column>
                                </Row>
                            </BarLink>
                        </BarItem>
                    </BarStart>
                    <BarEnd>
                        <BarItem>
                            <BarLink To="/Admin/Update-and-Versioning">
                                <Row>
                                    <Column ColumnSize="ColumnSize.IsAuto" Padding="Padding.Is0.FromEnd">
                                        <BarIcon IconName="IconName.Sync" />
                                    </Column>
                                    <Column Padding="Padding.Is2.FromStart">
                                        @Localizer["Update&Versioning"]
                                    </Column>
                                </Row>
                            </BarLink>
                        </BarItem>
                        <BarItem>
                            <BarLink To="https://github.com/aglasencnik/sportsorganizer" Target="Target.Blank">
                                <Row>
                                    <Column ColumnSize="ColumnSize.IsAuto" Padding="Padding.Is0.FromEnd">
                                        &nbsp;<Icon IconSize="IconSize.Large" Name="@("fab fa-github")" />
                                    </Column>
                                    <Column Padding="Padding.Is2.FromStart">
                                        GitHub
                                    </Column>
                                </Row>
                            </BarLink>
                        </BarItem>
                    </BarEnd>
                </BarMenu>
            </Bar>
        </LayoutSiderContent>
    </LayoutSider>
    <Layout>
        <LayoutHeader>
            <Bar @ref="@topBar" @bind-Visible="@topBarVisible"
                 Breakpoint="Breakpoint.Desktop" Background="HeaderBackground" ThemeContrast="HeaderThemeContrast">
                <BarToggler Bar="@sideBar" Border="Border.Is0" />
                <BarMenu>
                    <BarStart>
                        <BarItem Margin="Margin.Is3.FromEnd">
                            <BarLink To="/" Shadow="Shadow.Small" Border="Border.Rounded.Is1.Primary.OnBottom.Is1.Primary.OnTop" TextWeight="TextWeight.Normal">
                                @Localizer["Homepage"]
                            </BarLink>
                        </BarItem>
                    </BarStart>
                    <BarEnd>
                        <BarItem Margin="Margin.Is5.FromEnd">
                            <BarLink To="https://github.com/aglasencnik/sportsorganizer" Target="Target.Blank">
                                <Icon Name="@("fab fa-github")" />
                                GitHub
                            </BarLink>
                        </BarItem>
                    </BarEnd>
                </BarMenu>
            </Bar>
        </LayoutHeader>
        <CascadingValue Value="@this" IsFixed>
            <LayoutContent Padding="Padding.Is0.OnX.Is4.OnY.Is4.OnWidescreen">
                <Container Breakpoint="Breakpoint.Widescreen">
                    <Row>
                        <Column ColumnSize="ColumnSize.Is12.Is10.OnDesktop">
                            @Body
                        </Column>
                    </Row>
                </Container>
            </LayoutContent>
        </CascadingValue>
    </Layout>
</Layout>

@code {
    [Inject]
    public IStringLocalizer<AdminLayout> Localizer { get; set; }

    [Inject]
    public MemoryStorageUtility MemoryStorage { get; set; }

    private Bar sideBar;
    private Bar topBar;
    private bool topBarVisible;
    private ThemeContrast SidebarThemeContrast;
    private ThemeContrast HeaderThemeContrast;
    private Background HeaderBackground;

    RenderFragment customIcon = @<Image Source="/img/logo.svg" Style="width:32px; height: 32px" />;

    protected override async Task OnInitializedAsync()
    {
        string altText = Localizer["SportsOrganizerLogo"];

        var faviconObj = MemoryStorage.GetValue(KeyValueType.Favicon);
        var favicon = (faviconObj != null) ? (string)faviconObj : "favicon.png";

        customIcon = @<Image Source="@favicon" Text="@altText" Style="width:32px; height: 32px" />;

        var sidebarThemeContrastObj = MemoryStorage.GetValue(KeyValueType.AdminLayoutBarThemeContrast);
        if (sidebarThemeContrastObj != null) SidebarThemeContrast = (ThemeContrast)sidebarThemeContrastObj;
        else SidebarThemeContrast = ThemeContrast.Light;

        var headerThemeContrastObj = MemoryStorage.GetValue(KeyValueType.AdminLayoutHeaderThemeContrast);
        if (headerThemeContrastObj != null) HeaderThemeContrast = (ThemeContrast)headerThemeContrastObj;
        else HeaderThemeContrast = ThemeContrast.Light;

        var headerBackgroundObj = MemoryStorage.GetValue(KeyValueType.AdminLayoutHeaderBackground);
        if (headerBackgroundObj != null) HeaderBackground = (Background)headerBackgroundObj;
        else HeaderBackground = Background.Light;
    }
}